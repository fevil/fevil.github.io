---
id: 156
title:
  - История борьбы со спамом
author: fevil
layout: post
guid: http://fevil.org.ru/?p=156
permalink: /?p=156
description:
  - История о том как я впервые столкнулся с боевым почтовым сервером, кучей пользователей почтовые ящики которых были завалены спамом. И как я все это разгрибал
keywords:
  - спам, SpamAssassin, greylisting, борьба со спамом, почтовый сервер
robotsmeta:
  - index,follow
post_views_count:
  - 2
categories:
  - Internet
tags:
  - email
  - SpamAssassin
  - почта
  - спам
---
<p style="text-align: justify;">
  Проблема нежелательной почты стала перед системными администраторами практически сразу с распространением глобальной сети internet. В коммерции все способы привлечения внимания к своему товару и услугам хороши, поэтому заказы на массовые рассылки всегда будут актуальны, впрочем, как  и лаборатории по производству программного обеспечения для этих целей. Рассмотрим что можно сделать на почтовом сервере небольшой фирмы для уменьшения траты времени на разбор не желаемой корреспонденции.
</p>

<p style="text-align: justify;">
  <!--more-->
</p>

<p style="text-align: justify;">
  Первый почтовый сервер который мне довелось администрировать, достался мне по наследству от администратора, который уходил в другую организацию и передавал мне дела. После выяснения каким образом можно добавить, удалить или изменить учетные записи пользователей, а так же разбора  часто встречающихся проблем, был задан вопрос &#8211; каким образом осуществляется борьба со спамом. На что получил ответ который меня несколько удивил &#8211; со спамом бороться бесполезно, пользователи сами разбирают что важно а что нет.  Получив пожелания творческих успехов, от человека применявшего интеллектуальный фильтр борьбы со спамом и остался один на один с сервером и пользователями
</p>

<p style="text-align: justify;">
  Количество спама в почтовых ящиках пользователей в несколько раз превышало полезные письма. В то время на почтовом сервере yandex.ru практически все нежелательные  письма помечались в теме сообщения надписью &#8211; &#8221; Возможно спам &#8220;.  Решено было сделать подобную систему у себя.  После прочтения документации к почтовому серверу  и многочисленных конференций очевидным решением было использовать всем известный продукт открытый продукт &#8211; SpamAssassin. Который анализирует каждое письмо, прогоняет его по набору правил, и на каждом начисляет баллы. Если сумма балов превысило установленный порог  &#8211; то в тему письма дописывается заданное в конфигурации предупреждение. У пользователей были созданы локальные директории в почтовых клиентах и написаны правила по которым помеченные письма, из входящих  перемещались в  них. Это немного облегчило жизнь пользователям, но было много ложных срабатываний и большой почтовый трафик, оплата за который была помегабайтной.
</p>

<p style="text-align: justify;">
  Ложные срабатывания постепенно были сведены к минимуму экспериментами по настройки конфигурации и обучению  утилитой sa-learn, которой скармливались письма  со спамом, и письма ошибочно помеченные спамом. Эти письма пользователи выкладывали на общий сетевой ресурс, доступный только на запись, и обрабатывались скриптом по расписанию.
</p>

<p style="text-align: justify;">
  Следующим этапом очень хотелось уменьшить почтовый трафик генерируемый письмами со спамом. Для этого первым делом удалил все стандартные почтовые ящики и алиасы такие как: support, webmaster, root, postmaster, sale&#8230; Известив тех, кто мог от этого пострадать. Так же настроил сервер таким образом, чтобы письма на несуществующие ящики не пересылались postmater&#8217;у а отвергались с ответом: 550-Mailbox unknown.
</p>

<p style="text-align: justify;">
  Все почтовые сервера, не имеющий обратной записи в ДНС также решено было отвергать, чтобы не получать письма со спамом. С помощью скрипта отвергались так же почтовые сервера в доменых именах которых были слова ADSL, dialup, user. Борьба шла, но число количество  сообщений со спамом по прежнему превышало полезные. Следующим открытием, в борьбе со спамом, для меня были списки RBL, теперь это DNSBL. Эти списки содержат базы данных адресов с которых были замечены массовые рассылки писем со спамом. Это было серьёзным прорывом. Заметно уменьшилось количество корреспонденции со спамом. Дышать стало полегче, да и благодарность от некоторых пользователей пошла. Это радовало. Но некоторое количество нежелательной корреспонденции все же имелось.
</p>

<p style="text-align: justify;">
  В это время  в рассылках часто можно было заметить горячие обсуждения так называемых серых списков. Суть их состояла в том, что адреса отправителей с которыми ведется постоянная переписка, помещаются в список, нахождение в котором говорить почтовому серверу о том что, можно принимать письма от этого адресата спокойно. Если же адреса отправителя нет в списке, то письмо отвергается до повторного возвращения. Таким образом исключаются рассылки писем со спамом, организованные спамерами. Так как повторно письма высылают не многие.  На подчиненном мне почтовом сервере была настроена технология серых списков. Вначале её внедрения приходилось объяснять  некоторым пользователям почему есть задержка в получении некоторых писем, но все плюсы технологии, не могут не радовать. На данный момент эту технологию я считаю наиболее эффективной в борьбе со спамом.
</p>

<p style="text-align: justify;">
  Выше описанными действиями удалось избавится от лишнего почтового трафика, и уменьшение времени пользователей на разбор почтовых сообщений. Отпала необходимость пользователей искать важное письмо в куче мусора. Так же был сделан вывод, что бороться со спамом все таки стоит. Полностью проблема не решилась иногда проскакивают рекламные письма, но практически всегда они помечаются в теме.
</p>